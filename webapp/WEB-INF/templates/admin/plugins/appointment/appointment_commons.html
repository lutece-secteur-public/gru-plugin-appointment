<#macro commonsAppJS>
<script src="js/plugins/appointment/jquery.min.js"></script>
<script src="js/plugins/appointment/moment.min.js" ></script>
<script src="js/plugins/appointment/fullcalendar.min.js"></script>
<script src="js/plugins/appointment/locale-all.js"></script>
<script src="js/plugins/appointment/bootstrap-datepicker.js" ></script>
<script src="js/locales/bootstrap-datepicker.fr.js" ></script>
<script src="js/plugins/appointment/bootstrap-datetimepicker.min.js"></script>
<link rel='stylesheet' href='css/plugins/appointment/bootstrap-datetimepicker.css' >
<link rel="stylesheet" href="js/plugins/appointment/fullcalendar.min.css" >
<link rel="stylesheet" href="css/admin/plugins/appointment/appointment.css" >
<link rel="stylesheet" href="css/admin/plugins/appointment/fullcalendar.custom.css" >
</#macro>

<#--
-- Check if the checkbox must be checked or not
-- @param code the checkbox code
-- @param referecen_list the default values list
-- @return the String 'checked="checked" if the checkbox must be checked, an empty String otherwise
-->
<#function getChecked code reference_list>
	<#if reference_list?has_content>
		<#list reference_list as reference_item>
			<#if reference_item.code = code>
				<#if reference_item.checked>
  					<#return "checked='checked'">
  				<#else>
  					<#return "">
  				</#if>
  			</#if>
  		</#list>
	</#if>
	<#return "">
</#function>

<#--
-- Get the value of the parameter
-- @param code the code of the parameter
-- @param referecen_list the default values list
-- @return the value of the parameter
-->
<#function getName code reference_list>
	<#if reference_list?has_content>
		<#list reference_list as reference_item>
			<#if reference_item.code = code>
  				<#return reference_item.name>
  			</#if>
  		</#list>
	</#if>
	<#return "">
</#function>

<#--
-- Get the field from a given title
-- @param entry the entry
-- @param fieldTitle the title
-- @return the field
-->
<#function getField entry fieldTitle>
	<#if entry.fields?? && entry.fields?has_content>
		<#list entry.fields as field>
			<#if field?? && field.title?? && field.title == fieldTitle>
				<#return field>
			</#if>
		</#list>
	</#if>
</#function>

<#-- 
-- Get the field value from a given entry and a given title
-- @param entry the entry
-- @param fieldTitle the title
-- @return the field
-->
<#function getFieldValue entry fieldTitle>
	<#if getField( entry, fieldTitle )??>
		<#assign field = getField( entry, fieldTitle )>
		<#return field.value>
	</#if>
	<#return "">
</#function>

<#-- 
-- Get the max files value of an entry
-- @param entry the entry
-- @return the number of max authorized uploaded files
-->
<#function getMaxFiles entry>
	<#assign fieldMaxFiles = getFieldValueByCode( entry, "max_files" )>
	<#if fieldMaxFiles?? && fieldMaxFiles != "">
		<#return fieldMaxFiles>
	</#if>
	<#return "1">
</#function>

<#-- 
-- Get the max size an uploaded file is authorized to have
-- @param entry the entry
-- @return the max size
-->
<#function getFileMaxSize entry>
	<#assign fieldFileMaxSize = getFieldValueByCode( entry, "file_max_size" )>
	<#if fieldFileMaxSize?? && fieldFileMaxSize != "">
		<#return fieldFileMaxSize>
	<#else>
		<#if getField( entry, "option" )??>
			<#assign fieldFileMaxSize = getFieldValueByCode( entry, "option" )>
			<#return fieldFileMaxSize.width> 
		</#if>
	</#if>
	<#return "5242880">
</#function>

<#--
-- Check if the given entry must export the binary
-- @param entry the entry
-- @return true if it must export the binaries, false otherwise
-->
<#function exportBinary entry>
	<#assign field = getFieldValue( entry, "export_binary" ) />
	<#if field?? && field = "true">
		<#return true />
	</#if>
	<#return false />
</#function>

<#-- 
-- Get the field value from a given entry and a given title
-- @param entry the entry
-- @param fieldTitle the title
-- @return the field
-->
<#function getFieldValueByCode entry fieldCode>
	<#if getFieldByCode( entry, fieldCode )??>
		<#assign field = getFieldByCode( entry, fieldCode )>
		<#return field.value>
	</#if>
	<#return "">
</#function>

<#--
-- Get the field from a given code
-- @param entry the entry
-- @param fieldCode the code
-- @return the field
-->
<#function getFieldByCode entry fieldCode>
    <#if entry.fields?? && entry.fields?has_content>
        <#list entry.fields as field>
            <#if field?? && field.code?? && field.code == fieldCode>
                <#return field>
            </#if>
        </#list>
    </#if>
</#function>

<#macro getCommentForm idComment idStartingDate idEndingDate idStartingTime idEndingTime action idForm locale=locale>
<@tform action='jsp/admin/plugins/appointment/Comments.jsp'>
    <@input type='hidden' name='action' value='${action}' />
    <@input type='hidden' name='id_form' value='${idForm}' />
	<#if comment??><#assign value="${comment.id!''}" /><#else><#assign value='' /></#if>
    <@input type='hidden' name='id_comment' value=value />
	
	<@fieldSet>
		<@formGroup labelFor='comment' labelKey='#i18n{appointment.comment.name}' mandatory=true rows=2>
			<@input type='textarea' name='comment' id=idComment richtext=true />
		</@formGroup>
		<@formGroup labelFor='startingValidityDate' labelKey='#i18n{appointment.create_comment.labelStartingValidityDate}' mandatory=true rows=2>
			<@inputGroup>
				<@input type='text' name='startingValidityDate' id=idStartingDate />
				<@inputGroupItem type='text'>
				<@icon style='calendar' />
				</@inputGroupItem>
			</@inputGroup>
		</@formGroup>
		
		<@formGroup labelFor='startingValidityTime' labelKey='#i18n{appointment.create_comment.labelStartingValidityTime}' rows=2>
	        <@inputGroup>
	            <@input type='text' name='startingValidityTime' id=idStartingTime />
	            <@inputGroupItem type='addon'>
	            <@icon style='calendar' />
	            </@inputGroupItem>
	        </@inputGroup>
	    </@formGroup>
	    
		<@formGroup labelFor='endingValidityDate' labelKey='#i18n{appointment.create_comment.labelEndingValidityDate}' mandatory=true rows=2>
			<@inputGroup>
				<@input type='text' name='endingValidityDate' id=idEndingDate />
				<@inputGroupItem type='text'>
				<@icon style='calendar' />
				</@inputGroupItem>
			</@inputGroup>
		</@formGroup>
		
		<@formGroup labelFor='endingValidityTime' labelKey='#i18n{appointment.create_comment.labelEndingValidityTime}' rows=2>
	        <@inputGroup>
	            <@input type='text' name='endingValidityTime' id=idEndingTime />
	            <@inputGroupItem type='addon'>
	            <@icon style='calendar' />
	            </@inputGroupItem>
	        </@inputGroup>
	    </@formGroup>
	    
		<@formGroup rows=2>
			<@button type='submit' name='action_${action}' buttonIcon='save' title='Enregistrer' />   
		</@formGroup>
	</@fieldSet>

</@tform>
<script>
$('#${idStartingDate}').datepicker({language: '${locale}', autoclose: true});
$('#${idEndingDate}').datepicker({language: '${locale}', autoclose: true});
$('#${idStartingTime}').datetimepicker({format: 'HH:mm', stepping: 5});
$('#${idEndingTime}').datetimepicker({format: 'HH:mm', stepping: 5});
</script>
</#macro>

<#macro btnComment >
<div id="btn-comment-main">
	<@button id='toggle-add-comment' style='none' class='btn btn-link' title='#i18n{appointment.create_comment.pageTitle}' hideTitle=['all'] params=' data-toggle="modal" data-target="#commentModal" ' buttonNested=true>
		<@iconStack class='fa-sm'>
			<@icon style='plus' class='fa-stack-1x' />
			<@icon prefix='far fa-'style='comment' class='fa-stack-2x' />
		</@iconStack>
	</@button>
</div>
</#macro>

<#macro appointmentTabs tab form>
<@commonsAppJS />
<@tabs params=' style="margin-top:15px"'>
	<@tabList>
		<#if tab?ends_with("Week")>
			<#if tab="typicalWeek"><#assign active = true /><#else><#assign active = false /></#if>
			<@tabLink href='jsp/admin/plugins/appointment/ManageAppointmentSlots.jsp?view=manageTypicalWeek&id_form=${appointmentform.idForm}' title='#i18n{appointment.typicalWeek.pageTitle}' active=active />
			<#if tab="specificWeek"><#assign active = true /><#else><#assign active = false /></#if>
			<@tabLink href='jsp/admin/plugins/appointment/ManageSpecificWeek.jsp?view=manageSpecificWeek&id_form=${appointmentform.idForm}' title='#i18n{appointment.specificWeek.pageTitle}' active=active /> 			 
			<@tabLink href='jsp/admin/plugins/appointment/ManageAnnualCalendar.jsp?view=manageAnnualCalendar&id_form=${appointmentform.idForm}' title='#i18n{appointment.annual.calendar.pageTitle}' active=false />  			
			<@tabLink href='jsp/admin/plugins/appointment/modules/desk/ManageAppointmentDesks.jsp?plugin_name=appointment-desk&id_form=${appointmentform.idForm}' title='#i18n{appointment.specificDay.pageTitle}' active=false />  
		<#else>
			<#if tab="calendar"><#assign active = true /><#else><#assign active = false /></#if>
			<@tabLink href='jsp/admin/plugins/appointment/ManageAppointments.jsp?view=viewCalendarManageAppointment&id_form=${form.idForm}' title='#i18n{appointment.manageAppointmentCalendar.pageTitle}' active=active />
			<#if tab="filter"><#assign active = true /><#else><#assign active = false /></#if>
			<@tabLink href='jsp/admin/plugins/appointment/ManageAppointments.jsp?view=manageAppointments&id_form=${form.idForm}' title='#i18n{appointment.manageAppointments.pageTitle}' active=active />
		</#if>
	</@tabList>
	<@tabContent>
		<@messages errors=errors warnings=warnings infos=infos />
		<#nested>
		<#if formCalendarErrors??>
			<div class="layout-wrapper"></div>
		<#else>
			<@btnComment />
			<div id="calendar"></div>
		</#if>
	</@tabContent>
</@tabs>
<script>
/* Add Form title */
$('.content-header > h1 > small').html( "${form.title}" );
</script>
</#macro>

<#macro modifyAppointmentFormLeftColumn appointmentform >
<script src="js/jquery/plugins/ui/â€‹jquery-ui-1.9.2.custom.min.js"></script>
<@getDatePickerBootstrap idField="date_start_validity" language=language />
<@getDatePickerBootstrap idField="date_end_validity"   language=language />
<@getDatePickerBootstrap idField="time_start_validity" language=language />
<@getDatePickerBootstrap idField="time_end_validity"   language=language />
<script type="text/javascript">
	function validateQty(event) {
		var key = window.event ? event.keyCode : event.which;
	
	if (event.keyCode == 8 || event.keyCode == 9 || event.keyCode == 46
	 || event.keyCode == 37 || event.keyCode == 39) {
		return true;
	}
	else if ( key < 48 || key > 57 ) {
		return false;
	}
	else return true;
	};
	$('#date_start_validity').datepicker({
    	language:		"${language}",
    	weekStart: 1,
    	todayBtn: true,
    	todayHighLight: true,
    	autoclose: true
	});
	$('#date_end_validity').datepicker({
	    language:		"${language}",
	    weekStart: 1,
	    todayBtn: true,
	    todayHighLight: true,
	    autoclose: true
	});
	$(function () {
        $('#time_start').datetimepicker({
          format: 'HH:mm',
          stepping: 5
        });
        $('#time_end').datetimepicker({
          format: 'HH:mm',
          stepping: 5
        });     
    });
</script>
</#macro> 